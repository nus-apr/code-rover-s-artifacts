INFO: Running with entropic power schedule (0xFF, 100).
INFO: Seed: 2604062962
INFO: Loaded 1 modules   (6207 inline 8-bit counters): 6207 [0x8808e0, 0x88211f),
INFO: Loaded 1 PC tables (6207 PCs): 6207 [0x61a188,0x632578),
/out/fuzz_lua: Running 1 inputs 1 time(s) each.
Running: /tmp/poc
=================================================================
==17==ERROR: AddressSanitizer: heap-use-after-free on address 0x61800000ba38 at pc 0x000000557415 bp 0x7ffce6eae870 sp 0x7ffce6eae868
WRITE of size 1 at 0x61800000ba38 thread T0
SCARINESS: 41 (1-byte-write-heap-use-after-free)
    #0 0x557414 in lua_closeslot /src/lua/lapi.c:209:3
    #1 0x5cdb68 in luaL_pushresult /src/lua/lauxlib.c:586:5
    #2 0x5cdb68 in luaL_traceback /src/lua/lauxlib.c:163:3
    #3 0x556aab in msghandler /src/lua/fuzz_lua.c:111:3
    #4 0x573033 in luaD_precall /src/lua/ldo.c:500:11
    #5 0x5737c5 in ccall /src/lua/ldo.c:543:13
    #6 0x5737c5 in luaD_callnoyield /src/lua/ldo.c:563:3
    #7 0x56d201 in luaG_errormsg /src/lua/ldebug.c:772:5
    #8 0x56bdfd in luaG_runerror /src/lua/ldebug.c:788:3
    #9 0x567df6 in luaG_typeerror /src/lua/ldebug.c:694:3
    #10 0x56cbc0 in luaG_opinterror /src/lua/ldebug.c:727:3
    #11 0x5b23ac in luaT_trybinTM /src/lua/ltm.c
    #12 0x5bdd4f in luaV_execute /src/lua/lvm.c:1484:9
    #13 0x5737f6 in ccall /src/lua/ldo.c:545:5
    #14 0x5737f6 in luaD_callnoyield /src/lua/ldo.c:563:3
    #15 0x5700e0 in luaD_rawrunprotected /src/lua/ldo.c:144:3
    #16 0x5752a4 in luaD_pcall /src/lua/ldo.c:843:12
    #17 0x563c47 in lua_pcallk /src/lua/lapi.c:1056:14
    #18 0x556919 in docall /src/lua/fuzz_lua.c:127:12
    #19 0x556888 in dochunk /src/lua/fuzz_lua.c:135:34
    #20 0x55681e in LLVMFuzzerTestOneInput /src/lua/fuzz_lua.c:150:5
    #21 0x45a021 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:599:15
    #22 0x443ce2 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:323:6
    #23 0x44a036 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:856:9
    #24 0x474042 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10
    #25 0x7bef0378983f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2083f)
    #26 0x41e888 in _start (/out/fuzz_lua+0x41e888)

DEDUP_TOKEN: lua_closeslot--luaL_pushresult--luaL_traceback
0x61800000ba38 is located 440 bytes inside of 880-byte region [0x61800000b880,0x61800000bbf0)
freed by thread T0 here:
    #0 0x522e39 in realloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:164:3
    #1 0x58db28 in luaM_realloc_ /src/lua/lmem.c:166:14
    #2 0x570231 in luaD_reallocstack /src/lua/ldo.c:183:20
    #3 0x572ebe in luaD_growstack /src/lua/ldo.c:223:14
    #4 0x572ebe in luaD_precall /src/lua/ldo.c:488:7
    #5 0x5737c5 in ccall /src/lua/ldo.c:543:13
    #6 0x5737c5 in luaD_callnoyield /src/lua/ldo.c:563:3
    #7 0x57da72 in callclosemethod /src/lua/lfunc.c:118:5
    #8 0x57da72 in prepcallclosemth /src/lua/lfunc.c:153:3
    #9 0x57da72 in luaF_close /src/lua/lfunc.c:216:7
    #10 0x5573e6 in lua_closeslot /src/lua/lapi.c:208:3
    #11 0x5cdb68 in luaL_pushresult /src/lua/lauxlib.c:586:5
    #12 0x5cdb68 in luaL_traceback /src/lua/lauxlib.c:163:3
    #13 0x556aab in msghandler /src/lua/fuzz_lua.c:111:3
    #14 0x573033 in luaD_precall /src/lua/ldo.c:500:11
    #15 0x5737c5 in ccall /src/lua/ldo.c:543:13
    #16 0x5737c5 in luaD_callnoyield /src/lua/ldo.c:563:3
    #17 0x56d201 in luaG_errormsg /src/lua/ldebug.c:772:5
    #18 0x56bdfd in luaG_runerror /src/lua/ldebug.c:788:3
    #19 0x567df6 in luaG_typeerror /src/lua/ldebug.c:694:3
    #20 0x56cbc0 in luaG_opinterror /src/lua/ldebug.c:727:3
    #21 0x5b23ac in luaT_trybinTM /src/lua/ltm.c
    #22 0x5bdd4f in luaV_execute /src/lua/lvm.c:1484:9
    #23 0x5737f6 in ccall /src/lua/ldo.c:545:5
    #24 0x5737f6 in luaD_callnoyield /src/lua/ldo.c:563:3
    #25 0x5700e0 in luaD_rawrunprotected /src/lua/ldo.c:144:3
    #26 0x5752a4 in luaD_pcall /src/lua/ldo.c:843:12
    #27 0x563c47 in lua_pcallk /src/lua/lapi.c:1056:14
    #28 0x556919 in docall /src/lua/fuzz_lua.c:127:12
    #29 0x556888 in dochunk /src/lua/fuzz_lua.c:135:34
    #30 0x55681e in LLVMFuzzerTestOneInput /src/lua/fuzz_lua.c:150:5
    #31 0x45a021 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:599:15
    #32 0x443ce2 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:323:6
    #33 0x44a036 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:856:9
    #34 0x474042 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10
    #35 0x7bef0378983f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2083f)

DEDUP_TOKEN: realloc--luaM_realloc_--luaD_reallocstack
previously allocated by thread T0 here:
    #0 0x522e39 in realloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:164:3
    #1 0x58db28 in luaM_realloc_ /src/lua/lmem.c:166:14
    #2 0x570231 in luaD_reallocstack /src/lua/ldo.c:183:20
    #3 0x570966 in luaD_shrinkstack /src/lua/ldo.c:271:5
    #4 0x58a866 in traversethread /src/lua/lgc.c:644:5
    #5 0x58a866 in propagatemark /src/lua/lgc.c:662:30
    #6 0x583758 in incstep /src/lua/lgc.c:1652:19
    #7 0x583758 in luaC_step /src/lua/lgc.c:1673:7
    #8 0x56b69f in luaG_runerror /src/lua/ldebug.c:782:3
    #9 0x567df6 in luaG_typeerror /src/lua/ldebug.c:694:3
    #10 0x56cbc0 in luaG_opinterror /src/lua/ldebug.c:727:3
    #11 0x5b23ac in luaT_trybinTM /src/lua/ltm.c
    #12 0x5bdd4f in luaV_execute /src/lua/lvm.c:1484:9
    #13 0x5737f6 in ccall /src/lua/ldo.c:545:5
    #14 0x5737f6 in luaD_callnoyield /src/lua/ldo.c:563:3
    #15 0x5700e0 in luaD_rawrunprotected /src/lua/ldo.c:144:3
    #16 0x5752a4 in luaD_pcall /src/lua/ldo.c:843:12
    #17 0x563c47 in lua_pcallk /src/lua/lapi.c:1056:14
    #18 0x556919 in docall /src/lua/fuzz_lua.c:127:12
    #19 0x556888 in dochunk /src/lua/fuzz_lua.c:135:34
    #20 0x55681e in LLVMFuzzerTestOneInput /src/lua/fuzz_lua.c:150:5
    #21 0x45a021 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:599:15
    #22 0x443ce2 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:323:6
    #23 0x44a036 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:856:9
    #24 0x474042 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10
    #25 0x7bef0378983f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2083f)

DEDUP_TOKEN: realloc--luaM_realloc_--luaD_reallocstack
SUMMARY: AddressSanitizer: heap-use-after-free /src/lua/lapi.c:209:3 in lua_closeslot
Shadow bytes around the buggy address:
  0x0c307fff96f0: fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa
  0x0c307fff9700: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c307fff9710: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c307fff9720: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c307fff9730: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
=>0x0c307fff9740: fd fd fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd
  0x0c307fff9750: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c307fff9760: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c307fff9770: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fa fa
  0x0c307fff9780: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c307fff9790: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==17==ABORTING
