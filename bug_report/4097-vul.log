INFO: Seed: 2263709470
INFO: Loaded 1 modules   (3759 guards): 3759 [0x9ecbc8, 0x9f0684), 
/out/fuzz_binary_message: Running 1 inputs 1 time(s) each.
Running: /tmp/poc
=================================================================
==13==ERROR: AddressSanitizer: heap-use-after-free on address 0x6120000017e0 at pc 0x0000005eb0b7 bp 0x7fffd3ac1170 sp 0x7fffd3ac1168
READ of size 8 at 0x6120000017e0 thread T0
SCARINESS: 51 (8-byte-read-heap-use-after-free)
    #0 0x5eb0b6 in UA_Subscription_answerPublishRequestsNoSubscription /src/open62541/src/server/ua_subscription.c:372:20
    #1 0x5e4b95 in processDelayedCallbacks /src/open62541/src/server/ua_server_worker.c:180:9
    #2 0x5e4b95 in UA_Server_run_shutdown /src/open62541/src/server/ua_server_worker.c:377
    #3 0x54e2c7 in LLVMFuzzerTestOneInput /src/open62541/tests/fuzz/fuzz_binary_message.cc:31:2
    #4 0x64a8c0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/libfuzzer/FuzzerLoop.cpp:499:13
    #5 0x629185 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/libfuzzer/FuzzerDriver.cpp:273:6
    #6 0x634939 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/libfuzzer/FuzzerDriver.cpp:690:9
    #7 0x628828 in main /src/libfuzzer/FuzzerMain.cpp:20:10
    #8 0x763ef2ade83f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2083f)
    #9 0x44ff68 in _start (/out/fuzz_binary_message+0x44ff68)

DEDUP_TOKEN: UA_Subscription_answerPublishRequestsNoSubscription--processDelayedCallbacks--UA_Server_run_shutdown
0x6120000017e0 is located 288 bytes inside of 312-byte region [0x6120000016c0,0x6120000017f8)
freed by thread T0 here:
    #0 0x5128e8 in __interceptor_cfree.localalias.0 /src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:76
    #1 0x5e4b95 in processDelayedCallbacks /src/open62541/src/server/ua_server_worker.c:180:9
    #2 0x5e4b95 in UA_Server_run_shutdown /src/open62541/src/server/ua_server_worker.c:377
    #3 0x54e2c7 in LLVMFuzzerTestOneInput /src/open62541/tests/fuzz/fuzz_binary_message.cc:31:2
    #4 0x64a8c0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/libfuzzer/FuzzerLoop.cpp:499:13
    #5 0x629185 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/libfuzzer/FuzzerDriver.cpp:273:6
    #6 0x634939 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/libfuzzer/FuzzerDriver.cpp:690:9
    #7 0x628828 in main /src/libfuzzer/FuzzerMain.cpp:20:10
    #8 0x763ef2ade83f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2083f)

DEDUP_TOKEN: __interceptor_cfree.localalias.0--processDelayedCallbacks--UA_Server_run_shutdown
previously allocated by thread T0 here:
    #0 0x512aa8 in malloc /src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:88
    #1 0x5e8736 in UA_SessionManager_createSession /src/open62541/src/server/ua_session_manager.c:129:58
    #2 0x5f2bdc in Service_CreateSession /src/open62541/src/server/ua_services_session.c:133:9
    #3 0x5e1300 in processMSG /src/open62541/src/server/ua_server_binary.c:406:9
    #4 0x5e0576 in processSecureChannelMessage /src/open62541/src/server/ua_server_binary.c:536:18
    #5 0x56d456 in UA_SecureChannel_finalizeChunk /src/open62541/src/ua_securechannel.c:726:28
    #6 0x56d456 in UA_SecureChannel_processChunk /src/open62541/src/ua_securechannel.c:991
    #7 0x5df55c in processCompleteChunk /src/open62541/src/server/ua_server_binary.c:654:12
    #8 0x56720a in processChunk /src/open62541/src/ua_connection.c:139:12
    #9 0x56720a in UA_Connection_processChunks /src/open62541/src/ua_connection.c:164
    #10 0x5df277 in processBinaryMessage /src/open62541/src/server/ua_server_binary.c:668:28
    #11 0x5df277 in UA_Server_processBinaryMessage /src/open62541/src/server/ua_server_binary.c:688
    #12 0x54e2ab in LLVMFuzzerTestOneInput /src/open62541/tests/fuzz/fuzz_binary_message.cc:28:5
    #13 0x64a8c0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/libfuzzer/FuzzerLoop.cpp:499:13
    #14 0x629185 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/libfuzzer/FuzzerDriver.cpp:273:6
    #15 0x634939 in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/libfuzzer/FuzzerDriver.cpp:690:9
    #16 0x628828 in main /src/libfuzzer/FuzzerMain.cpp:20:10
    #17 0x763ef2ade83f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2083f)

DEDUP_TOKEN: malloc--UA_SessionManager_createSession--Service_CreateSession
SUMMARY: AddressSanitizer: heap-use-after-free /src/open62541/src/server/ua_subscription.c:372:20 in UA_Subscription_answerPublishRequestsNoSubscription
Shadow bytes around the buggy address:
  0x0c247fff82a0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd
  0x0c247fff82b0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c247fff82c0: fd fd fd fd fd fd fd fd fd fd fd fd fa fa fa fa
  0x0c247fff82d0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd
  0x0c247fff82e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
=>0x0c247fff82f0: fd fd fd fd fd fd fd fd fd fd fd fd[fd]fd fd fa
  0x0c247fff8300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c247fff8310: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c247fff8320: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c247fff8330: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c247fff8340: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==13==ABORTING
